import F from"axios";var p=({message:t,statusCode:i,code:n,requestId:a,originalError:r})=>({name:"CommandError",message:t,statusCode:i,code:n,requestId:a,originalError:r}),ye=t=>typeof t=="object"&&t!==null&&"name"in t&&t.name==="CommandError",$=t=>{if(!t||typeof t!="object")return t;let i={...t};if(i.config&&typeof i.config=="object"){let n=i.config;if(n.httpsAgent&&typeof n.httpsAgent=="object"){let a=n.httpsAgent;delete a.sockets,delete a.freeSockets,delete a._sessionCache}}return i},u=t=>{if(F.isAxiosError(t)){let i=t.response?.data?.message,n=t.response?.status?`Request failed with status code ${t.response.status}`:t.message||"Request failed";throw p({message:i||n,statusCode:t.response?.status,code:t.code,requestId:t.response?.headers?.["x-request-id"],originalError:$(t)})}throw t};import e from"zod";var h=e.object({id:e.number(),code:e.string(),value:e.string()}),I=e.object({id:e.number(),code:e.string(),value:e.string()}),S=e.object({active:e.boolean(),mandatory:e.boolean(),systemDefined:e.boolean()}),x=e.object({id:e.number()}),R=e.object({id:e.number(),name:e.string().optional()}),D=e.object({active:e.boolean()}),v=e.object({submittedOnDate:e.array(e.number()),submittedByUsername:e.string().optional(),submittedByFirstname:e.string().optional(),submittedByLastname:e.string().optional(),activatedOnDate:e.array(e.number()).optional(),activatedByUsername:e.string().optional(),activatedByFirstname:e.string().optional(),activatedByLastname:e.string().optional()}),P=e.object({}).catchall(e.any()),M=e.object({}).catchall(e.any()),G=e.object({}).catchall(e.any()),A=e.object({constitution:P,mainBusinessLine:M,countryOfIncorporation:G}).catchall(e.any()),E=e.object({isExternalCardDebitDisable:e.boolean(),isExternalCardCreditDisable:e.boolean(),isAchDebitOutgoingDisable:e.boolean(),isAchCreditOutgoingDisable:e.boolean(),isAchDebitIncomingDisable:e.boolean(),isAchCreditIncomingDisable:e.boolean(),isInternalCreditDisable:e.boolean(),isInternalDebitDisable:e.boolean(),isWireCreditOutgoingDisable:e.boolean(),isWireCreditIncomingDisable:e.boolean(),isSwiftCreditOutgoingDisable:e.boolean(),isSwiftCreditIncomingDisable:e.boolean(),isFxpayCreditOutgoingDisable:e.boolean(),isAllocateToSubAccountDisable:e.boolean(),isInternalCreditOwnDisable:e.boolean(),type:e.string(),resourceId:e.number(),id:e.number()}).catchall(e.any()),w=e.object({}).catchall(e.any()),O=e.object({id:e.number(),accountNo:e.string(),status:I,subStatus:S,active:e.boolean(),activationDate:e.array(e.number()).optional(),firstname:e.string(),lastname:e.string(),displayName:e.string(),mobileNo:e.string(),emailAddress:e.string(),dateOfBirth:e.array(e.number()),gender:x,clientTypes:e.array(e.any()),clientClassification:R,occupation:D,isStaff:e.boolean(),skipAvs:e.boolean(),officeId:e.number(),officeName:e.string(),imageId:e.string().optional(),imagePresent:e.boolean().optional(),timeline:v,legalForm:h,clientVerificationStatus:e.string(),updatedAt:e.string(),isBlockExternalCardsAddition:e.boolean(),clientNonPersonDetails:A,clientTransferOptionData:E,authorizations:e.array(e.number()).optional(),mobileCountryCode:e.string(),clientKycStatus:w,ofLoanCycle:e.number(),ofLoanActive:e.number(),activeDepositAccount:e.number(),onBoardingStatus:e.string().optional()}).catchall(e.any()),K=e.object({riskScore:e.number(),rating:e.string()}).catchall(e.any()),W=e.object({street:e.string(),city:e.string(),state:e.string(),zipCode:e.string()}).catchall(e.any()),_=e.object({type:e.string(),value:e.string()}).catchall(e.any()),V={firstname:e.string(),middlename:e.string().optional(),lastname:e.string(),fullname:e.string().optional(),dob:e.string(),genderId:e.number(),locale:e.string(),officeId:e.number(),mobileCountryCode:e.string(),mobileNo:e.string(),emailAddress:e.string().email(),legalFormId:e.number(),externalId:e.string().optional(),isOptedForMLALStatus:e.boolean().optional(),currentMLALStatus:e.string().optional(),isStaff:e.boolean().optional(),staffId:e.number().optional(),clientClassificationId:e.number().optional(),savingsProductId:e.number().optional(),active:e.boolean().optional(),dateFormat:e.string(),activationDate:e.string().optional(),submittedOnDate:e.string(),dateOfBirth:e.string()},xe=e.object(V).catchall(e.any()),J={clientId:e.number(),status:e.string()},Re=e.object(J).catchall(e.any()),H={firstname:e.string().optional(),middlename:e.string().optional(),fullname:e.string().optional(),genderId:e.number().optional(),lastname:e.string().optional(),occupationId:e.number().optional(),mobileCountryCode:e.string().optional(),mobileNo:e.string().optional(),emailAddress:e.string().email().optional(),externalId:e.string().optional(),clientClassificationId:e.number().optional(),dateOfBirth:e.string().optional(),dateFormat:e.string().optional()},De=e.object(H).catchall(e.any()),Q={documentTypeId:e.string(),documentKey:e.string(),status:e.string(),description:e.string().optional(),issuedBy:e.string().optional(),locale:e.string().optional(),dateFormat:e.string().optional(),expiryDate:e.string().optional(),nationality:e.number().optional(),issuedDate:e.string().optional()},ve=e.object(Q).catchall(e.any()),Z={id:e.number(),officeId:e.number(),clientId:e.number(),resourceId:e.number(),changes:e.record(e.string(),e.any()),isScheduledTransfer:e.boolean(),isSkipNotification:e.boolean()},Ae=e.object(Z).catchall(e.any()),X={developerMessage:e.string(),defaultUserMessage:e.string(),userMessageGlobalisationCode:e.string(),parameterName:e.string().optional(),value:e.any().nullable(),args:e.array(e.object({value:e.any()})).optional()},Y=e.object(X),ee={developerMessage:e.string(),httpStatusCode:e.string(),defaultUserMessage:e.string(),userMessageGlobalisationCode:e.string(),errors:e.array(Y).optional()},Ee=e.object(ee).catchall(e.any()),te={tenantId:e.string().optional(),offset:e.number().optional(),limit:e.number().optional(),orderBy:e.string().optional(),sortOrder:e.string().optional(),officeId:e.number().optional(),displayName:e.string().optional(),firstname:e.string().optional(),lastname:e.string().optional(),externalId:e.string().optional(),orphansOnly:e.boolean().optional(),clientStatus:e.string().optional(),mobileNo:e.string().optional(),createdStartDate:e.string().optional(),creationEndDate:e.string().optional(),activatedStartDate:e.string().optional(),activatedEndDate:e.string().optional(),closedStartDate:e.string().optional(),closedEndDate:e.string().optional()},we=e.object(te),Oe={id:e.number(),accountNo:e.string(),status:I,subStatus:S,active:e.boolean(),activationDate:e.array(e.number()).optional(),firstname:e.string(),lastname:e.string(),displayName:e.string(),mobileNo:e.string(),emailAddress:e.string(),dateOfBirth:e.array(e.number()),gender:x,clientTypes:e.array(e.any()),clientClassification:R,occupation:D,isStaff:e.boolean(),skipAvs:e.boolean(),officeId:e.number(),officeName:e.string(),imageId:e.string().optional(),imagePresent:e.boolean().optional(),timeline:v,legalForm:h,clientVerificationStatus:e.string(),updatedAt:e.string(),isBlockExternalCardsAddition:e.boolean(),clientNonPersonDetails:A,clientTransferOptionData:E,authorizations:e.array(e.number()).optional(),mobileCountryCode:e.string(),clientKycStatus:w,ofLoanCycle:e.number(),ofLoanActive:e.number(),activeDepositAccount:e.number(),onBoardingStatus:e.string().optional()},ne={totalFilteredRecords:e.number(),pageItems:e.array(O)},ke=e.object(ne).catchall(e.any()),ie={clientData:O.optional(),riskRatingData:K.optional(),clientAddressData:W.optional(),clientIdentifierData:_.optional()},qe=e.object(ie);var ae=e.enum(["offset","limit","orderBy","sortOrder","officeId","displayName","firstname","lastname","externalId","orphansOnly","clientStatus","mobileNo","createdStartDate","creationEndDate","activatedStartDate","activatedEndDate","closedStartDate","closedEndDate"]),oe=e.enum(["displayName","accountNo","officeId","officeName"]),re=e.enum(["ASC","DESC"]),se=e.enum(["ACTIVE","PENDING","INACTIVE"]),b=t=>ae.parse(t),le=t=>oe.parse(t),ce=t=>re.parse(t),de=t=>se.parse(t),k=t=>{try{for(let[i,n]of Object.entries(t))if(b(i),n!=null)switch(i){case"orderBy":le(n);break;case"sortOrder":ce(n);break;case"clientStatus":de(n);break;case"offset":case"limit":case"officeId":e.number().min(0).parse(n);break;case"orphansOnly":e.boolean().parse(n);break;case"displayName":case"firstname":case"lastname":case"externalId":case"mobileNo":case"createdStartDate":case"creationEndDate":case"activatedStartDate":case"activatedEndDate":case"closedStartDate":case"closedEndDate":e.string().min(1).parse(n);break}}catch(i){throw i instanceof e.ZodError?p({message:`Validation error: ${i.errors.map(n=>n.message).join(", ")}`,code:"validation_error"}):i}};import me from"axios";import{v4 as fe}from"uuid";import*as j from"https";import pe from"axios";import ue from"jsonwebtoken";var q=(t,i)=>{if(!t)throw p({message:"Missing JWT secret",code:"missing_jwt_secret"});return ue.sign({signee:i},t,{algorithm:"HS512",expiresIn:"1d"})||""},U=async(t,i,n,a)=>{let r={method:"POST",url:`${i}/oauth/token`,headers:{"Content-Type":"application/x-www-form-urlencoded",tenantId:n},data:a},{data:{access_token:d}}=await pe.request(r);return t=d,t};var L={token:""},Ce=t=>t&&(t.startsWith("Bearer ")?t:`Bearer ${t}`),m=async t=>{let n=me.create({timeout:t.axiosConfig?.timeout||29e3,baseURL:t.baseUrl,headers:{"Content-Type":"application/json; charset=utf-8","JWT-Token":t?.secret?`${q(t?.secret,t?.signee||"")}`:void 0,Authorization:t.bearerToken!==void 0?Ce(t.bearerToken):t.credential?`Bearer ${L.token||await U(L.token,t.baseUrl,t.tenantId,t.credential)}`:void 0,"trace-id":t.traceId||`RequestUUID=${fe()}`,tenantId:t.tenantId},httpsAgent:new j.Agent({rejectUnauthorized:!0,keepAlive:t.axiosConfig?.keepAlive})});return t.logger&&t.logger(n),n};var Ye=t=>({input:t,metadata:{commandName:"GetClient",path:`/v1/clients/${t.clientId}`,method:"GET"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{let a={},r=new URLSearchParams;t.staffInSelectedOfficeOnly&&r.append("staffInSelectedOfficeOnly","true"),t.checkIdentitiesExpiration&&r.append("checkIdentitiesExpiration","true"),t.clientAccountAssociate&&r.append("clientAccountAssociate","true");let d=r.toString(),o=`/v1/clients/${t.clientId}${d?`?${d}`:""}`,s=await n.get(o);if(a.clientData=s,t.riskRating){let l=await n.get(`/v1/clients/${t.clientId}/riskrating`);a.riskRatingData=l}if(t.clientAddress){let l=await n.get(`/v1/client/${t.clientId}/addresses`);a.clientAddressData=l}if(t.clientIdentifier){let l=await n.get(`/v1/clients/${t.clientId}/identifiers?unmaskValue=true`);a.clientIdentifierData=l}return a}catch(a){u(a)}}}),et=t=>({input:t,metadata:{commandName:"UpdateClient",path:`/v1/clients/${t.clientId}`,method:"PUT"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.put(`/v1/clients/${t.clientId}`,{...t.updates})).data}catch(a){u(a)}}}),tt=t=>({input:t,metadata:{commandName:"UpdateClientIdentifier",path:`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,method:"PUT"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.put(`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,{...t.updates})).data}catch(a){u(a)}}}),nt=t=>({input:t,metadata:{commandName:"CreateClient",path:"/v1/clients",method:"POST"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.post("/v1/clients",t.clientData)).data}catch(a){u(a)}}}),C=(t,i,n,a)=>{if(i!==void 0&&i!==0&&i<=0)throw p({message:`Invalid limit: ${i}. Limit must be positive or 0 for fetching all records.`,code:"invalid_limit"});if(n!==void 0&&n<0)throw p({message:`Invalid offset: ${n}. Offset must be non-negative.`,code:"invalid_offset"});return{where:o=>(b(o),{eq:s=>(k({[o]:s}),C({...t,[o]:s},i,n,a))}),limit:o=>C(t,o,n,a),offset:o=>C(t,i,o,a),all:()=>C(t,0,n,a),execute:()=>{let o={...t,limit:i||200,offset:n||0};return{input:{filters:t,limit:i,offset:n,tenantId:a},metadata:{commandName:"ListClients",path:"/v1/clients",method:"GET"},execute:async s=>{a&&(s.tenantId=a);let l=await m(s);try{if(i===0){let c=[],f=n||0,g=0;do{let T={...t,limit:200,offset:f},N=await l.get("/v1/clients",{params:T}),{totalFilteredRecords:z,pageItems:B}=N.data;c.push(...B),g=z,f+=200}while(f<g);return{totalFilteredRecords:g,pageItems:c}}else return(await l.get("/v1/clients",{params:o})).data}catch(c){u(c)}}}}}},it=t=>({list:()=>C({},void 0,void 0,t?.tenantId)}),at=(t,i)=>({input:{params:t,configuration:i},metadata:{commandName:"GetClients",path:"/v1/clients",method:"GET"},execute:async n=>{i.tenantId&&(n.tenantId=i.tenantId);let a=await m(n),r=[],d=t.limit||200,o=t.offset||0,s=0,l={...t,limit:d,offset:o};try{if(t.limit===0){do{let c=await a.get("/v1/clients",{params:l}),{totalFilteredRecords:y,pageItems:f}=c.data;r.push(...f),s=y,o+=d}while(o<s);return{totalFilteredRecords:s,pageItems:r}}else return(await a.get("/v1/clients",{params:l})).data}catch(c){u(c)}}}),ot=t=>({input:t,metadata:{commandName:"DeleteClient",path:`/v1/clients/${t.clientId}`,method:"DELETE"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.delete(`/v1/clients/${t.clientId}`)).data}catch(a){u(a)}}});export{p as a,ye as b,u as c,m as d,Ye as e,et as f,tt as g,nt as h,it as i,at as j,ot as k};
