"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);var p=({message:t,statusCode:i,code:n,requestId:a,originalError:r})=>({name:"CommandError",message:t,statusCode:i,code:n,requestId:a,originalError:r}),ye= exports.b =t=>typeof t=="object"&&t!==null&&"name"in t&&t.name==="CommandError",$=t=>{if(!t||typeof t!="object")return t;let i={...t};if(i.config&&typeof i.config=="object"){let n=i.config;if(n.httpsAgent&&typeof n.httpsAgent=="object"){let a=n.httpsAgent;delete a.sockets,delete a.freeSockets,delete a._sessionCache}}return i},u= exports.c =t=>{if(_axios2.default.isAxiosError(t)){let i=_optionalChain([t, 'access', _2 => _2.response, 'optionalAccess', _3 => _3.data, 'optionalAccess', _4 => _4.message]),n=_optionalChain([t, 'access', _5 => _5.response, 'optionalAccess', _6 => _6.status])?`Request failed with status code ${t.response.status}`:t.message||"Request failed";throw p({message:i||n,statusCode:_optionalChain([t, 'access', _7 => _7.response, 'optionalAccess', _8 => _8.status]),code:t.code,requestId:_optionalChain([t, 'access', _9 => _9.response, 'optionalAccess', _10 => _10.headers, 'optionalAccess', _11 => _11["x-request-id"]]),originalError:$(t)})}throw t};var _zod = require('zod'); var _zod2 = _interopRequireDefault(_zod);var h=_zod2.default.object({id:_zod2.default.number(),code:_zod2.default.string(),value:_zod2.default.string()}),I=_zod2.default.object({id:_zod2.default.number(),code:_zod2.default.string(),value:_zod2.default.string()}),S=_zod2.default.object({active:_zod2.default.boolean(),mandatory:_zod2.default.boolean(),systemDefined:_zod2.default.boolean()}),x=_zod2.default.object({id:_zod2.default.number()}),R=_zod2.default.object({id:_zod2.default.number(),name:_zod2.default.string().optional()}),D=_zod2.default.object({active:_zod2.default.boolean()}),v=_zod2.default.object({submittedOnDate:_zod2.default.array(_zod2.default.number()),submittedByUsername:_zod2.default.string().optional(),submittedByFirstname:_zod2.default.string().optional(),submittedByLastname:_zod2.default.string().optional(),activatedOnDate:_zod2.default.array(_zod2.default.number()).optional(),activatedByUsername:_zod2.default.string().optional(),activatedByFirstname:_zod2.default.string().optional(),activatedByLastname:_zod2.default.string().optional()}),P=_zod2.default.object({}).catchall(_zod2.default.any()),M=_zod2.default.object({}).catchall(_zod2.default.any()),G=_zod2.default.object({}).catchall(_zod2.default.any()),A=_zod2.default.object({constitution:P,mainBusinessLine:M,countryOfIncorporation:G}).catchall(_zod2.default.any()),E=_zod2.default.object({isExternalCardDebitDisable:_zod2.default.boolean(),isExternalCardCreditDisable:_zod2.default.boolean(),isAchDebitOutgoingDisable:_zod2.default.boolean(),isAchCreditOutgoingDisable:_zod2.default.boolean(),isAchDebitIncomingDisable:_zod2.default.boolean(),isAchCreditIncomingDisable:_zod2.default.boolean(),isInternalCreditDisable:_zod2.default.boolean(),isInternalDebitDisable:_zod2.default.boolean(),isWireCreditOutgoingDisable:_zod2.default.boolean(),isWireCreditIncomingDisable:_zod2.default.boolean(),isSwiftCreditOutgoingDisable:_zod2.default.boolean(),isSwiftCreditIncomingDisable:_zod2.default.boolean(),isFxpayCreditOutgoingDisable:_zod2.default.boolean(),isAllocateToSubAccountDisable:_zod2.default.boolean(),isInternalCreditOwnDisable:_zod2.default.boolean(),type:_zod2.default.string(),resourceId:_zod2.default.number(),id:_zod2.default.number()}).catchall(_zod2.default.any()),w=_zod2.default.object({}).catchall(_zod2.default.any()),O=_zod2.default.object({id:_zod2.default.number(),accountNo:_zod2.default.string(),status:I,subStatus:S,active:_zod2.default.boolean(),activationDate:_zod2.default.array(_zod2.default.number()).optional(),firstname:_zod2.default.string(),lastname:_zod2.default.string(),displayName:_zod2.default.string(),mobileNo:_zod2.default.string(),emailAddress:_zod2.default.string(),dateOfBirth:_zod2.default.array(_zod2.default.number()),gender:x,clientTypes:_zod2.default.array(_zod2.default.any()),clientClassification:R,occupation:D,isStaff:_zod2.default.boolean(),skipAvs:_zod2.default.boolean(),officeId:_zod2.default.number(),officeName:_zod2.default.string(),imageId:_zod2.default.string().optional(),imagePresent:_zod2.default.boolean().optional(),timeline:v,legalForm:h,clientVerificationStatus:_zod2.default.string(),updatedAt:_zod2.default.string(),isBlockExternalCardsAddition:_zod2.default.boolean(),clientNonPersonDetails:A,clientTransferOptionData:E,authorizations:_zod2.default.array(_zod2.default.number()).optional(),mobileCountryCode:_zod2.default.string(),clientKycStatus:w,ofLoanCycle:_zod2.default.number(),ofLoanActive:_zod2.default.number(),activeDepositAccount:_zod2.default.number(),onBoardingStatus:_zod2.default.string().optional()}).catchall(_zod2.default.any()),K=_zod2.default.object({riskScore:_zod2.default.number(),rating:_zod2.default.string()}).catchall(_zod2.default.any()),W=_zod2.default.object({street:_zod2.default.string(),city:_zod2.default.string(),state:_zod2.default.string(),zipCode:_zod2.default.string()}).catchall(_zod2.default.any()),_=_zod2.default.object({type:_zod2.default.string(),value:_zod2.default.string()}).catchall(_zod2.default.any()),V={firstname:_zod2.default.string(),middlename:_zod2.default.string().optional(),lastname:_zod2.default.string(),fullname:_zod2.default.string().optional(),dob:_zod2.default.string(),genderId:_zod2.default.number(),locale:_zod2.default.string(),officeId:_zod2.default.number(),mobileCountryCode:_zod2.default.string(),mobileNo:_zod2.default.string(),emailAddress:_zod2.default.string().email(),legalFormId:_zod2.default.number(),externalId:_zod2.default.string().optional(),isOptedForMLALStatus:_zod2.default.boolean().optional(),currentMLALStatus:_zod2.default.string().optional(),isStaff:_zod2.default.boolean().optional(),staffId:_zod2.default.number().optional(),clientClassificationId:_zod2.default.number().optional(),savingsProductId:_zod2.default.number().optional(),active:_zod2.default.boolean().optional(),dateFormat:_zod2.default.string(),activationDate:_zod2.default.string().optional(),submittedOnDate:_zod2.default.string(),dateOfBirth:_zod2.default.string()},xe=_zod2.default.object(V).catchall(_zod2.default.any()),J={clientId:_zod2.default.number(),status:_zod2.default.string()},Re=_zod2.default.object(J).catchall(_zod2.default.any()),H={firstname:_zod2.default.string().optional(),middlename:_zod2.default.string().optional(),fullname:_zod2.default.string().optional(),genderId:_zod2.default.number().optional(),lastname:_zod2.default.string().optional(),occupationId:_zod2.default.number().optional(),mobileCountryCode:_zod2.default.string().optional(),mobileNo:_zod2.default.string().optional(),emailAddress:_zod2.default.string().email().optional(),externalId:_zod2.default.string().optional(),clientClassificationId:_zod2.default.number().optional(),dateOfBirth:_zod2.default.string().optional(),dateFormat:_zod2.default.string().optional()},De=_zod2.default.object(H).catchall(_zod2.default.any()),Q={documentTypeId:_zod2.default.string(),documentKey:_zod2.default.string(),status:_zod2.default.string(),description:_zod2.default.string().optional(),issuedBy:_zod2.default.string().optional(),locale:_zod2.default.string().optional(),dateFormat:_zod2.default.string().optional(),expiryDate:_zod2.default.string().optional(),nationality:_zod2.default.number().optional(),issuedDate:_zod2.default.string().optional()},ve=_zod2.default.object(Q).catchall(_zod2.default.any()),Z={id:_zod2.default.number(),officeId:_zod2.default.number(),clientId:_zod2.default.number(),resourceId:_zod2.default.number(),changes:_zod2.default.record(_zod2.default.string(),_zod2.default.any()),isScheduledTransfer:_zod2.default.boolean(),isSkipNotification:_zod2.default.boolean()},Ae=_zod2.default.object(Z).catchall(_zod2.default.any()),X={developerMessage:_zod2.default.string(),defaultUserMessage:_zod2.default.string(),userMessageGlobalisationCode:_zod2.default.string(),parameterName:_zod2.default.string().optional(),value:_zod2.default.any().nullable(),args:_zod2.default.array(_zod2.default.object({value:_zod2.default.any()})).optional()},Y=_zod2.default.object(X),ee={developerMessage:_zod2.default.string(),httpStatusCode:_zod2.default.string(),defaultUserMessage:_zod2.default.string(),userMessageGlobalisationCode:_zod2.default.string(),errors:_zod2.default.array(Y).optional()},Ee=_zod2.default.object(ee).catchall(_zod2.default.any()),te={tenantId:_zod2.default.string().optional(),offset:_zod2.default.number().optional(),limit:_zod2.default.number().optional(),orderBy:_zod2.default.string().optional(),sortOrder:_zod2.default.string().optional(),officeId:_zod2.default.number().optional(),displayName:_zod2.default.string().optional(),firstname:_zod2.default.string().optional(),lastname:_zod2.default.string().optional(),externalId:_zod2.default.string().optional(),orphansOnly:_zod2.default.boolean().optional(),clientStatus:_zod2.default.string().optional(),mobileNo:_zod2.default.string().optional(),createdStartDate:_zod2.default.string().optional(),creationEndDate:_zod2.default.string().optional(),activatedStartDate:_zod2.default.string().optional(),activatedEndDate:_zod2.default.string().optional(),closedStartDate:_zod2.default.string().optional(),closedEndDate:_zod2.default.string().optional()},we=_zod2.default.object(te),Oe={id:_zod2.default.number(),accountNo:_zod2.default.string(),status:I,subStatus:S,active:_zod2.default.boolean(),activationDate:_zod2.default.array(_zod2.default.number()).optional(),firstname:_zod2.default.string(),lastname:_zod2.default.string(),displayName:_zod2.default.string(),mobileNo:_zod2.default.string(),emailAddress:_zod2.default.string(),dateOfBirth:_zod2.default.array(_zod2.default.number()),gender:x,clientTypes:_zod2.default.array(_zod2.default.any()),clientClassification:R,occupation:D,isStaff:_zod2.default.boolean(),skipAvs:_zod2.default.boolean(),officeId:_zod2.default.number(),officeName:_zod2.default.string(),imageId:_zod2.default.string().optional(),imagePresent:_zod2.default.boolean().optional(),timeline:v,legalForm:h,clientVerificationStatus:_zod2.default.string(),updatedAt:_zod2.default.string(),isBlockExternalCardsAddition:_zod2.default.boolean(),clientNonPersonDetails:A,clientTransferOptionData:E,authorizations:_zod2.default.array(_zod2.default.number()).optional(),mobileCountryCode:_zod2.default.string(),clientKycStatus:w,ofLoanCycle:_zod2.default.number(),ofLoanActive:_zod2.default.number(),activeDepositAccount:_zod2.default.number(),onBoardingStatus:_zod2.default.string().optional()},ne={totalFilteredRecords:_zod2.default.number(),pageItems:_zod2.default.array(O)},ke=_zod2.default.object(ne).catchall(_zod2.default.any()),ie={clientData:O.optional(),riskRatingData:K.optional(),clientAddressData:W.optional(),clientIdentifierData:_.optional()},qe=_zod2.default.object(ie);var ae=_zod2.default.enum(["offset","limit","orderBy","sortOrder","officeId","displayName","firstname","lastname","externalId","orphansOnly","clientStatus","mobileNo","createdStartDate","creationEndDate","activatedStartDate","activatedEndDate","closedStartDate","closedEndDate"]),oe=_zod2.default.enum(["displayName","accountNo","officeId","officeName"]),re=_zod2.default.enum(["ASC","DESC"]),se=_zod2.default.enum(["ACTIVE","PENDING","INACTIVE"]),b=t=>ae.parse(t),le=t=>oe.parse(t),ce=t=>re.parse(t),de=t=>se.parse(t),k=t=>{try{for(let[i,n]of Object.entries(t))if(b(i),n!=null)switch(i){case"orderBy":le(n);break;case"sortOrder":ce(n);break;case"clientStatus":de(n);break;case"offset":case"limit":case"officeId":_zod2.default.number().min(0).parse(n);break;case"orphansOnly":_zod2.default.boolean().parse(n);break;case"displayName":case"firstname":case"lastname":case"externalId":case"mobileNo":case"createdStartDate":case"creationEndDate":case"activatedStartDate":case"activatedEndDate":case"closedStartDate":case"closedEndDate":_zod2.default.string().min(1).parse(n);break}}catch(i){throw i instanceof _zod2.default.ZodError?p({message:`Validation error: ${i.errors.map(n=>n.message).join(", ")}`,code:"validation_error"}):i}};var _uuid = require('uuid');var _https = require('https'); var j = _interopRequireWildcard(_https);var _jsonwebtoken = require('jsonwebtoken'); var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);var q=(t,i)=>{if(!t)throw p({message:"Missing JWT secret",code:"missing_jwt_secret"});return _jsonwebtoken2.default.sign({signee:i},t,{algorithm:"HS512",expiresIn:"1d"})||""},U=async(t,i,n,a)=>{let r={method:"POST",url:`${i}/oauth/token`,headers:{"Content-Type":"application/x-www-form-urlencoded",tenantId:n},data:a},{data:{access_token:d}}=await _axios2.default.request(r);return t=d,t};var L={token:""},Ce=t=>t&&(t.startsWith("Bearer ")?t:`Bearer ${t}`),m= exports.d =async t=>{let n=_axios2.default.create({timeout:_optionalChain([t, 'access', _12 => _12.axiosConfig, 'optionalAccess', _13 => _13.timeout])||29e3,baseURL:t.baseUrl,headers:{"Content-Type":"application/json; charset=utf-8","JWT-Token":_optionalChain([t, 'optionalAccess', _14 => _14.secret])?`${q(_optionalChain([t, 'optionalAccess', _15 => _15.secret]),_optionalChain([t, 'optionalAccess', _16 => _16.signee])||"")}`:void 0,Authorization:t.bearerToken!==void 0?Ce(t.bearerToken):t.credential?`Bearer ${L.token||await U(L.token,t.baseUrl,t.tenantId,t.credential)}`:void 0,"trace-id":t.traceId||`RequestUUID=${_uuid.v4.call(void 0, )}`,tenantId:t.tenantId},httpsAgent:new j.Agent({rejectUnauthorized:!0,keepAlive:_optionalChain([t, 'access', _17 => _17.axiosConfig, 'optionalAccess', _18 => _18.keepAlive])})});return t.logger&&t.logger(n),n};var Ye=t=>({input:t,metadata:{commandName:"GetClient",path:`/v1/clients/${t.clientId}`,method:"GET"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{let a={},r=new URLSearchParams;t.staffInSelectedOfficeOnly&&r.append("staffInSelectedOfficeOnly","true"),t.checkIdentitiesExpiration&&r.append("checkIdentitiesExpiration","true"),t.clientAccountAssociate&&r.append("clientAccountAssociate","true");let d=r.toString(),o=`/v1/clients/${t.clientId}${d?`?${d}`:""}`,s=await n.get(o);if(a.clientData=s,t.riskRating){let l=await n.get(`/v1/clients/${t.clientId}/riskrating`);a.riskRatingData=l}if(t.clientAddress){let l=await n.get(`/v1/client/${t.clientId}/addresses`);a.clientAddressData=l}if(t.clientIdentifier){let l=await n.get(`/v1/clients/${t.clientId}/identifiers?unmaskValue=true`);a.clientIdentifierData=l}return a}catch(a){u(a)}}}),et= exports.f =t=>({input:t,metadata:{commandName:"UpdateClient",path:`/v1/clients/${t.clientId}`,method:"PUT"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.put(`/v1/clients/${t.clientId}`,{...t.updates})).data}catch(a){u(a)}}}),tt= exports.g =t=>({input:t,metadata:{commandName:"UpdateClientIdentifier",path:`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,method:"PUT"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.put(`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,{...t.updates})).data}catch(a){u(a)}}}),nt= exports.h =t=>({input:t,metadata:{commandName:"CreateClient",path:"/v1/clients",method:"POST"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.post("/v1/clients",t.clientData)).data}catch(a){u(a)}}}),C=(t,i,n,a)=>{if(i!==void 0&&i!==0&&i<=0)throw p({message:`Invalid limit: ${i}. Limit must be positive or 0 for fetching all records.`,code:"invalid_limit"});if(n!==void 0&&n<0)throw p({message:`Invalid offset: ${n}. Offset must be non-negative.`,code:"invalid_offset"});return{where:o=>(b(o),{eq:s=>(k({[o]:s}),C({...t,[o]:s},i,n,a))}),limit:o=>C(t,o,n,a),offset:o=>C(t,i,o,a),all:()=>C(t,0,n,a),execute:()=>{let o={...t,limit:i||200,offset:n||0};return{input:{filters:t,limit:i,offset:n,tenantId:a},metadata:{commandName:"ListClients",path:"/v1/clients",method:"GET"},execute:async s=>{a&&(s.tenantId=a);let l=await m(s);try{if(i===0){let c=[],f=n||0,g=0;do{let T={...t,limit:200,offset:f},N=await l.get("/v1/clients",{params:T}),{totalFilteredRecords:z,pageItems:B}=N.data;c.push(...B),g=z,f+=200}while(f<g);return{totalFilteredRecords:g,pageItems:c}}else return(await l.get("/v1/clients",{params:o})).data}catch(c){u(c)}}}}}},it= exports.i =t=>({list:()=>C({},void 0,void 0,_optionalChain([t, 'optionalAccess', _19 => _19.tenantId]))}),at= exports.j =(t,i)=>({input:{params:t,configuration:i},metadata:{commandName:"GetClients",path:"/v1/clients",method:"GET"},execute:async n=>{i.tenantId&&(n.tenantId=i.tenantId);let a=await m(n),r=[],d=t.limit||200,o=t.offset||0,s=0,l={...t,limit:d,offset:o};try{if(t.limit===0){do{let c=await a.get("/v1/clients",{params:l}),{totalFilteredRecords:y,pageItems:f}=c.data;r.push(...f),s=y,o+=d}while(o<s);return{totalFilteredRecords:s,pageItems:r}}else return(await a.get("/v1/clients",{params:l})).data}catch(c){u(c)}}}),ot= exports.k =t=>({input:t,metadata:{commandName:"DeleteClient",path:`/v1/clients/${t.clientId}`,method:"DELETE"},execute:async i=>{t.tenantId&&(i.tenantId=t.tenantId);let n=await m(i);try{return(await n.delete(`/v1/clients/${t.clientId}`)).data}catch(a){u(a)}}});exports.a = p; exports.b = ye; exports.c = u; exports.d = m; exports.e = Ye; exports.f = et; exports.g = tt; exports.h = nt; exports.i = it; exports.j = at; exports.k = ot;
