import c from"axios";var m=({message:e,statusCode:t,code:r,requestId:s,originalError:n})=>({name:"CommandError",message:e,statusCode:t,code:r,requestId:s,originalError:n}),E=e=>typeof e=="object"&&e!==null&&"name"in e&&e.name==="CommandError",u=e=>{if(!e||typeof e!="object")return e;let t={...e};if(t.config&&typeof t.config=="object"){let r=t.config;if(r.httpsAgent&&typeof r.httpsAgent=="object"){let s=r.httpsAgent;delete s.sockets,delete s.freeSockets,delete s._sessionCache}}return t},w=e=>{if(c.isAxiosError(e)){let t=e.response?.data?.message,r=e.response?.status?`Request failed with status code ${e.response.status}`:e.message||"Request failed";throw m({message:t||r,statusCode:e.response?.status,code:e.code,requestId:e.response?.headers?.["x-request-id"],originalError:u(e)})}throw e};import f from"axios";import{v4 as h}from"uuid";import*as p from"https";import l from"axios";import g from"jsonwebtoken";var o=(e,t)=>{if(!e)throw new Error("Missing JWT secret");return g.sign({signee:t},e,{algorithm:"HS512",expiresIn:"1d"})||""},a=async(e,t,r,s)=>{let n={method:"POST",url:`${t}/oauth/token`,headers:{"Content-Type":"application/x-www-form-urlencoded",tenantId:r},data:s},{data:{access_token:d}}=await l.request(n);return e=d,e};var i={token:""},A=e=>e&&(e.startsWith("Bearer ")?e:`Bearer ${e}`),R=async e=>{let r=f.create({timeout:e.axiosConfig?.timeout||29e3,baseURL:e.baseUrl,headers:{"Content-Type":"application/json; charset=utf-8","JWT-Token":e?.secret?`${o(e?.secret,e?.signee||"")}`:void 0,Authorization:e.bearerToken!==void 0?A(e.bearerToken):e.credential?`Bearer ${i.token||await a(i.token,e.baseUrl,e.tenantId,e.credential)}`:void 0,"trace-id":e.traceId||`RequestUUID=${h()}`,tenantId:e.tenantId},httpsAgent:new p.Agent({rejectUnauthorized:!0,keepAlive:e.axiosConfig?.keepAlive})});return e.logger&&e.logger(r),r};export{m as a,E as b,w as c,R as d};
