"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);var m=({message:e,statusCode:t,code:r,requestId:s,originalError:n})=>({name:"CommandError",message:e,statusCode:t,code:r,requestId:s,originalError:n}),E= exports.b =e=>typeof e=="object"&&e!==null&&"name"in e&&e.name==="CommandError",u=e=>{if(!e||typeof e!="object")return e;let t={...e};if(t.config&&typeof t.config=="object"){let r=t.config;if(r.httpsAgent&&typeof r.httpsAgent=="object"){let s=r.httpsAgent;delete s.sockets,delete s.freeSockets,delete s._sessionCache}}return t},w= exports.c =e=>{if(_axios2.default.isAxiosError(e)){let t=_optionalChain([e, 'access', _ => _.response, 'optionalAccess', _2 => _2.data, 'optionalAccess', _3 => _3.message]),r=_optionalChain([e, 'access', _4 => _4.response, 'optionalAccess', _5 => _5.status])?`Request failed with status code ${e.response.status}`:e.message||"Request failed";throw m({message:t||r,statusCode:_optionalChain([e, 'access', _6 => _6.response, 'optionalAccess', _7 => _7.status]),code:e.code,requestId:_optionalChain([e, 'access', _8 => _8.response, 'optionalAccess', _9 => _9.headers, 'optionalAccess', _10 => _10["x-request-id"]]),originalError:u(e)})}throw e};var _uuid = require('uuid');var _https = require('https'); var p = _interopRequireWildcard(_https);var _jsonwebtoken = require('jsonwebtoken'); var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);var o=(e,t)=>{if(!e)throw new Error("Missing JWT secret");return _jsonwebtoken2.default.sign({signee:t},e,{algorithm:"HS512",expiresIn:"1d"})||""},a=async(e,t,r,s)=>{let n={method:"POST",url:`${t}/oauth/token`,headers:{"Content-Type":"application/x-www-form-urlencoded",tenantId:r},data:s},{data:{access_token:d}}=await _axios2.default.request(n);return e=d,e};var i={token:""},A=e=>e&&(e.startsWith("Bearer ")?e:`Bearer ${e}`),R= exports.d =async e=>{let r=_axios2.default.create({timeout:_optionalChain([e, 'access', _11 => _11.axiosConfig, 'optionalAccess', _12 => _12.timeout])||29e3,baseURL:e.baseUrl,headers:{"Content-Type":"application/json; charset=utf-8","JWT-Token":_optionalChain([e, 'optionalAccess', _13 => _13.secret])?`${o(_optionalChain([e, 'optionalAccess', _14 => _14.secret]),_optionalChain([e, 'optionalAccess', _15 => _15.signee])||"")}`:void 0,Authorization:e.bearerToken!==void 0?A(e.bearerToken):e.credential?`Bearer ${i.token||await a(i.token,e.baseUrl,e.tenantId,e.credential)}`:void 0,"trace-id":e.traceId||`RequestUUID=${_uuid.v4.call(void 0, )}`,tenantId:e.tenantId},httpsAgent:new p.Agent({rejectUnauthorized:!0,keepAlive:_optionalChain([e, 'access', _16 => _16.axiosConfig, 'optionalAccess', _17 => _17.keepAlive])})});return e.logger&&e.logger(r),r};exports.a = m; exports.b = E; exports.c = w; exports.d = R;
