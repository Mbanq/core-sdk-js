"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _chunkE4GWSVC5js = require('./chunk-E4GWSVC5.js');var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);var _uuid = require('uuid');var _https = require('https'); var f = _interopRequireWildcard(_https);var _jsonwebtoken = require('jsonwebtoken'); var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);var p=(t,e)=>{if(!t)throw new Error("Missing JWT secret");return _jsonwebtoken2.default.sign({signee:e},t,{algorithm:"HS512",expiresIn:"1d"})||""},l=async(t,e,n,r)=>{let a={method:"POST",url:`${e}/oauth/token`,headers:{"Content-Type":"application/x-www-form-urlencoded",tenantId:n},data:r},{data:{access_token:i}}=await _axios2.default.request(a);return t=i,t};var I={token:""},s= exports.a =async t=>{let n=_axios2.default.create({timeout:_optionalChain([t, 'access', _2 => _2.axiosConfig, 'optionalAccess', _3 => _3.timeout])||29e3,baseURL:t.baseUrl,headers:{"Content-Type":"application/json; charset=utf-8","JWT-Token":_optionalChain([t, 'optionalAccess', _4 => _4.secret])?`${p(_optionalChain([t, 'optionalAccess', _5 => _5.secret]),_optionalChain([t, 'optionalAccess', _6 => _6.signee])||"")}`:void 0,Authorization:t.credential?`Bearer ${I.token||await l(I.token,t.baseUrl,t.tenantId,t.credential)}`:void 0,"trace-id":t.traceId||`RequestUUID=${_uuid.v4.call(void 0, )}`,tenantId:t.tenantId},httpsAgent:new f.Agent({rejectUnauthorized:!0,keepAlive:_optionalChain([t, 'access', _7 => _7.axiosConfig, 'optionalAccess', _8 => _8.keepAlive])})});return t.logger&&t.logger(n),n};var _=t=>({input:t,metadata:{commandName:"CreateTransfer",path:"/v1/transfers",method:"POST"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.post("/v1/transfers",t.transfer)).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),G= exports.c =t=>({input:t,metadata:{commandName:"GetTransfer",path:`/v1/transfers/${t.id}`,method:"GET"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.get(`/v1/transfers/${t.id}`)).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),M= exports.d =t=>{let e={paymentType:t.paymentType,status:t.transferStatus||"EXECUTION_SCHEDULED",toExecuteDate:t.executedAt,locale:"en",dateFormat:"yyyy-MM-dd",associateClientData:!0,originatedBy:"us",accountType:t.accountType};return{input:t,metadata:{commandName:"GetTransfers",path:"/v1/transfers",method:"GET"},execute:async n=>{t.tenantId&&(n.tenantId=t.tenantId);let r=await s(n),a=[],i=t.queryLimit||200,d=0,m=0,g={...e,limit:i,offset:d};try{do{let u=await r.get("/v1/transfers",{params:g}),{totalFilteredRecords:C,pageItems:h}=u.data;a.push(...h),m=C,d+=i}while(d<m);return a}catch(u){_chunkE4GWSVC5js.c.call(void 0, u)}}}},L= exports.e =t=>{let e={...t,paymentType:t.paymentType||"ACH"};return{input:t,metadata:{commandName:"MarkAsSuccess",path:"/v1/external-transfers?command=MARK_AS_SUCCESS",method:"POST"},execute:async n=>{t.tenantId&&(n.tenantId=t.tenantId);let r=await s(n);try{return(await r.post("/v1/external-transfers?command=MARK_AS_SUCCESS",e)).data}catch(a){_chunkE4GWSVC5js.c.call(void 0, a)}}}},q= exports.f =t=>({input:t,metadata:{commandName:"MarkAsProcessing",path:"/v1/external-transfers?command=MARK_AS_PROCESSING",method:"POST"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.post("/v1/external-transfers?command=MARK_AS_PROCESSING",t)).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),F= exports.g =t=>({input:t,metadata:{commandName:"MarkAsReturned",path:"/v1/external-transfers?command=MARK_AS_RETURN",method:"POST"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.post("/v1/external-transfers?command=MARK_AS_RETURN",{...t})).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),z= exports.h =t=>{let e={...t.payload};return{input:t,metadata:{commandName:"LogFailTransfer",path:"/v1/external-transfers?command=LOG_FAILURE",method:"POST"},execute:async n=>{t.tenantId&&(n.tenantId=t.tenantId);let r=await s(n);try{return(await r.post("/v1/external-transfers?command=LOG_FAILURE",e)).data}catch(a){throw _axios2.default.isAxiosError(a)?_chunkE4GWSVC5js.a.call(void 0, {message:"LogFailTransfer command failed",statusCode:_optionalChain([a, 'access', _9 => _9.response, 'optionalAccess', _10 => _10.status]),code:a.code,requestId:_optionalChain([a, 'access', _11 => _11.response, 'optionalAccess', _12 => _12.headers, 'optionalAccess', _13 => _13["x-request-id"]]),originalError:a}):a}}}},Q= exports.i =t=>({input:t,metadata:{commandName:"MarkAsFail",path:"/v1/external-transfers?command=MARK_AS_FAIL",method:"POST"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.post("/v1/external-transfers?command=MARK_AS_FAIL",t)).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),j= exports.j =t=>{let e={traceNumbers:t.traceNumbers};return{input:t,metadata:{commandName:"UpdateTraceNumber",path:`/v1/external-transfers/${t.externalId}`,method:"PUT"},execute:async n=>{t.tenantId&&(n.tenantId=t.tenantId);let r=await s(n);try{return(await r.put(`/v1/external-transfers/${t.externalId}`,e)).data}catch(a){_chunkE4GWSVC5js.c.call(void 0, a)}}}};var H=t=>{let e=t.skipNotification&&"?skipNotification=true"||"",n=t.card.cardType==="CREDIT"?"creditcards":"cards",r={...t.payload,query:e,flag:t.flag};return{input:t,metadata:{commandName:"SendAuthorizationToCore",path:`/${n}/${t.card.internalCardId}/authorization${e}`,method:"POST"},execute:async a=>{t.tenantId&&(a.tenantId=t.tenantId);let i=await s(a);try{return await i.post(`/${n}/${t.card.internalCardId}/authorization${e}`,r)}catch(d){_chunkE4GWSVC5js.c.call(void 0, d)}}}},B= exports.l =t=>({input:t,metadata:{commandName:"UpdateCardID",path:`/clients/${t.clientId}`,method:"PUT"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{await n.put(`/clients/${t.clientId}`,{businessCardIDURL:t.businessCardIDURL,businessCardIDQRCode:t.businessCardIDQRCode})}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}});var Z=t=>({input:t,metadata:{commandName:"GetClientData",path:`/v1/clients/${t.clientId}`,method:"GET"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e),r={clientData:void 0,riskRatingData:void 0,clientAddressData:void 0,clientIdentifierData:void 0};try{return r.clientData=await n.get(`/v1/clients/${t.clientId}`),t.riskRating&&(r.riskRatingData=await n.get(`/v1/clients/${t.clientId}/riskrating`)),t.clientAddress&&(r.clientAddressData=await n.get(`/v1/client/${t.clientId}/addresses`)),t.clientIdentifier&&(r.clientIdentifierData=await n.get(`/v1/clients/${t.clientId}/identifiers?unmaskValue=true`)),r}catch(a){_chunkE4GWSVC5js.c.call(void 0, a)}}}),tt= exports.n =t=>({input:t,metadata:{commandName:"UpdateClient",path:`/v1/clients/${t.clientId}`,method:"PUT"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.put(`/v1/clients/${t.clientId}`,{...t.updates})).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}}),et= exports.o =t=>({input:t,metadata:{commandName:"UpdateClientIdentifier",path:`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,method:"PUT"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e);try{return(await n.put(`/v1/clients/${t.clientId}/identifiers/${t.identifierId}`,{...t.updates})).data}catch(r){_chunkE4GWSVC5js.c.call(void 0, r)}}});var _graphql = require('graphql');var ot=t=>({input:t,metadata:{commandName:t.operationName||"GraphQL",path:"/graphql",method:"POST"},execute:async e=>{t.tenantId&&(e.tenantId=t.tenantId);let n=await s(e),r=e.graphqlPath||"/graphql";try{let a=typeof t.command=="string"?t.command:_graphql.print.call(void 0, t.command),{data:i}=await n.post(r,{query:a,variables:t.variables,operationName:t.operationName});if(_optionalChain([i, 'access', _14 => _14.errors, 'optionalAccess', _15 => _15.length]))throw _chunkE4GWSVC5js.a.call(void 0, {message:i.errors[0].message,code:"graphql_error",originalError:i.errors[0]});if(!i.data)throw _chunkE4GWSVC5js.a.call(void 0, {message:"No data returned from GraphQL query",code:"graphql_no_data"});return i.data}catch(a){throw a.name==="CommandError"?a:_chunkE4GWSVC5js.a.call(void 0, {message:a.message,code:"graphql_request_failed",originalError:a})}}});exports.a = s; exports.b = _; exports.c = G; exports.d = M; exports.e = L; exports.f = q; exports.g = F; exports.h = z; exports.i = Q; exports.j = j; exports.k = H; exports.l = B; exports.m = Z; exports.n = tt; exports.o = et; exports.p = ot;
